{"version":3,"sources":["../js/vz-cube.js"],"names":["map","n","start1","stop1","start2","stop2","constraint","min","max","Math","head","ls","tail","slice","init","last","length","Orientation","e","alpha","beta","gamma","l","yaw","pitch","VZCubeElement","_isAnimating","_isDragging","_isFrozen","_draggingMultiplier","_handleMouseDown","bind","_handleMouseMove","_handleMouseUp","_handleTouchStart","_handleTouchMove","_handleTouchEnd","_handleOrientation","_processAnimation","_refresh","_pivot","querySelector","_addEventHandlers","cancelAnimationFrame","_refreshId","clearTimeout","_removeEventHandlers","duration","callback","altYaw","abs","_animationStartPos","_animationEndPos","parseFloat","_animationStartTime","Date","now","_animationEndTime","_animationEndCallback","setAttribute","removeAttribute","t","addEventListener","window","removeEventListener","_lastDragEvent","pageX","pageY","touches","currentOrientation","_lastOrientation","undefined","diff","_easing","requestAnimationFrame","call","_normalize","perspective","getComputedStyle","style","transform","setTimeout","HTMLElement","customElements","define","VZCubeFeature","_yaw","getAttribute","_pitch","attrName","oldVal","newVal"],"mappings":"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","file":"vz-cube.js","sourcesContent":["/** @see https://github.com/processing/p5.js/blob/master/src/math/calculation.js */\n\nfunction map(n, start1, stop1, start2 = 0, stop2 = 1) {\n    return ((n - start1) / (stop1 - start1)) * (stop2 - start2) + start2\n}\nfunction constraint(n, min = 0, max = 1) {\n    return Math.min(Math.max(n, min), max)\n}\n\nfunction head(ls) { return ls[0] }\nfunction tail(ls) { return ls.slice(1) }\nfunction init(ls) { return ls.slice(0, -1) }\nfunction last(ls) { return ls[ls.length - 1] }\n\nclass Orientation {\n    constructor (e) {\n        this.alpha  = e.alpha\n        this.beta   = e.beta\n        this.gamma  = e.gamma\n    }\n\n    diff (l) {\n        return {\n            yaw:    l.alpha - this.alpha,\n            pitch:  this.beta - l.beta,\n        }\n    }\n}\n\n\nclass VZCubeElement extends HTMLElement {\n    constructor() {\n        super()\n\n        this._isAnimating   = false\n        this._isDragging    = false\n        this._isFrozen      = false\n\n        this._draggingMultiplier = 0.1\n\n        this.yaw    = 0\n        this.pitch  = 0\n\n        this._handleMouseDown   = this._handleMouseDown.bind(this)\n        this._handleMouseMove   = this._handleMouseMove.bind(this)\n        this._handleMouseUp     = this._handleMouseUp.bind(this)\n        this._handleTouchStart  = this._handleTouchStart.bind(this)\n        this._handleTouchMove   = this._handleTouchMove.bind(this)\n        this._handleTouchEnd    = this._handleTouchEnd.bind(this)\n        this._handleOrientation = this._handleOrientation.bind(this)\n        this._processAnimation  = this._processAnimation.bind(this)\n        this._refresh           = this._refresh.bind(this)\n    }\n\n    connectedCallback() {\n        this._pivot = this.querySelector('vz-cubepivot')\n        this._addEventHandlers()\n        this._refresh()\n    }\n\n    disconnectedCallback() {\n        typeof cancelAnimationFrame === 'function'\n            ? cancelAnimationFrame(this._refreshId)\n            : clearTimeout(this._refreshId)\n\n        this._removeEventHandlers()\n    }\n\n    animateTo(yaw, pitch, duration = 1000, callback = null) {\n        // set yaw to the neares yaw\n        const altYaw = yaw > 0\n            ? yaw - 360\n            : yaw + 360\n        if (Math.abs(altYaw - this.yaw) < Math.abs(yaw - this.yaw)) {\n            yaw = altYaw\n        }\n\n        this._isAnimating = true\n        this._animationStartPos     = { yaw: this.yaw, pitch: this.pitch }\n        this._animationEndPos       = { yaw: parseFloat(yaw) || 0, pitch: parseFloat(pitch) || 0 }\n        this._animationStartTime    = Date.now()\n        this._animationEndTime      = Date.now() + duration\n        this._animationEndCallback  = callback\n    }\n\n    freeze() {\n        this._isFrozen = true\n    }\n\n    unfreeze() {\n        this._isFrozen = false\n    }\n\n    zoomIn() {\n        this.setAttribute('zoom', true)\n    }\n    zoomOut() {\n        this.removeAttribute('zoom')\n    }\n\n    _easing(t) {\n        return t<.5 ? 2*t*t : -1+(4-2*t)*t\n    }\n\n    _addEventHandlers() {\n        this.addEventListener('mousedown', this._handleMouseDown)\n        window.addEventListener('mousemove', this._handleMouseMove)\n        window.addEventListener('mouseup', this._handleMouseUp)\n        this.addEventListener('touchstart', this._handleTouchStart)\n        this.addEventListener('touchmove', this._handleTouchMove)\n        this.addEventListener('touchend', this._handleTouchEnd)\n        this.addEventListener('touchcancel', this._handleTouchEnd)\n        window.addEventListener('deviceorientation', this._handleOrientation)\n    }\n\n    _removeEventHandlers() {\n        this.removeEventListener('mousedown', this._handleMouseDown)\n        window.removeEventListener('mousemove', this._handleMouseMove)\n        window.removeEventListener('mouseup', this._handleMouseUp)\n        this.removeEventListener('touchstart', this._handleTouchStart)\n        this.removeEventListener('touchmove', this._handleTouchMove)\n        this.removeEventListener('touchend', this._handleTouchEnd)\n        this.removeEventListener('touchcancel', this._handleTouchEnd)\n        window.removeEventListener('deviceorientation', this._handleOrientation)\n    }\n\n    _handleMouseDown(e) {\n        this._isDragging = true\n        this._lastDragEvent = e\n    }\n\n    _handleMouseMove(e) {\n        if (!this._isDragging || this._isAnimating || this._isFrozen) return\n\n        this.yaw    += (this._lastDragEvent.pageX - e.pageX) * this._draggingMultiplier\n        this.pitch  -= constraint((this._lastDragEvent.pageY - e.pageY) * this._draggingMultiplier, -70, 70)\n\n        this._lastDragEvent = e\n    }\n\n    _handleMouseUp(e) {\n        this._isDragging = false\n    }\n\n    _handleTouchStart(e) {\n        this._isDragging = true\n        this._lastDragEvent = e.touches[0]\n    }\n\n    _handleTouchMove(e) {\n        if (!this._isDragging || this._isAnimating || this._isFrozen) return\n\n        this.yaw    += (this._lastDragEvent.pageX - e.touches[0].pageX) * this._draggingMultiplier\n        this.pitch  -= (this._lastDragEvent.pageY - e.touches[0].pageY) * this._draggingMultiplier\n\n        this._lastDragEvent = e.touches[0]\n    }\n\n    _handleTouchEnd(e) {\n        this._isDragging = false\n    }\n\n    _handleOrientation(e) {\n        const currentOrientation = new Orientation(e)\n\n        if (this._lastOrientation !== undefined) {\n            this.yaw    += currentOrientation.diff(this._lastOrientation).yaw\n            this.pitch  += currentOrientation.diff(this._lastOrientation).pitch\n        }\n\n        this._lastOrientation = currentOrientation\n    }\n\n\n    _processAnimation() {\n        if (!this._isAnimating) return\n\n        const now = Date.now()\n        const t = map(now, this._animationStartTime, this._animationEndTime, 0, 1)\n\n        this.yaw    = map(this._easing(t), 0, 1, this._animationStartPos.yaw, this._animationEndPos.yaw)\n        this.pitch  = map(this._easing(t), 0, 1, this._animationStartPos.pitch, this._animationEndPos.pitch)\n\n        if (this._animationEndTime <= now) {\n            this._isAnimating   = false\n            this.yaw            = this._animationEndPos.yaw\n            this.pitch          = this._animationEndPos.pitch\n\n            // @TODO normalize\n\n            if (typeof this._animationEndCallback === 'function') {\n                requestAnimationFrame(_ => this._animationEndCallback.call(this))\n            }\n        }\n    }\n\n    _normalize() {\n        this.pitch = constraint(this.pitch, -70, 70)\n        if (this.yaw > 180) this.yaw -= 360\n        if (this.yaw < -180) this.yaw += 360\n    }\n\n    _refresh() {\n        this._processAnimation()\n        this._normalize()\n\n        const perspective = getComputedStyle(this).perspective\n\n        this._pivot.style.transform = `translateZ(${perspective}) rotateX(${this.pitch}deg) rotateY(${this.yaw}deg)`\n\n        // recurse\n        this._refreshId = typeof requestAnimationFrame === 'function'\n            ? requestAnimationFrame(this._refresh)\n            : setTimeout(this._refresh, 1000/30)\n    }\n}\n\ncustomElements.define('vz-cube', VZCubeElement)\n\n\n\nclass VZCubeFeature extends HTMLElement {\n    constructor () {\n        super()\n\n        this._yaw       = this.getAttribute('yaw')\n        this._pitch     = this.getAttribute('pitch')\n        this._refresh   = this._refresh.bind(this)\n\n        this._refresh()\n    }\n\n    connectedCallback() {\n    }\n\n    attributeChangedCallback(attrName, oldVal, newVal) {\n        switch (attrName) {\n            case 'yaw':\n                this._yaw = parseFloat(newVal) || 0; break\n            case 'pitch':\n                this._pitch = parseFloat(newVal) || 0; break\n        }\n\n        this._refresh()\n    }\n\n    _refresh() {\n        this.style.transform = `rotateY(${this.yaw}deg) rotateX(${this.pitch}deg) translateZ(calc(-50vmax + 2rem))`\n    }\n\n    get yaw() {\n        return this._yaw\n    }\n    get pitch() {\n        return this._pitch\n    }\n}\n\ncustomElements.define('vz-cube-feature', VZCubeFeature);\n"]}