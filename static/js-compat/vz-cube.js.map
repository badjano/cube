{"version":3,"sources":["../js/vz-cube.js"],"names":["map","n","start1","stop1","start2","stop2","constraint","min","max","Math","head","ls","tail","slice","init","last","length","VZCubeElement","isAnimating","_isDragging","yaw","pitch","_handleMouseDown","bind","_handleMouseMove","_handleMouseUp","_handleTouchStart","_handleTouchMove","_handleTouchEnd","_refresh","_pivot","querySelector","_addEventHandlers","cancelAnimationFrame","_refreshId","clearTimeout","_removeEventHandlers","addEventListener","window","removeEventListener","e","_lastDragEvent","pageX","pageY","touches","perspective","getComputedStyle","style","transform","requestAnimationFrame","setTimeout","HTMLElement","document","registerElement"],"mappings":"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","file":"vz-cube.js","sourcesContent":["/** @see https://github.com/processing/p5.js/blob/master/src/math/calculation.js */\nfunction map(n, start1, stop1, start2 = 0, stop2 = 1) {\n    return ((n - start1) / (stop1 - start1)) * (stop2 - start2) + start2\n}\nfunction constraint(n, min = 0, max = 1) {\n    return Math.min(Math.max(n, min), max)\n}\n\nfunction head(ls) { return ls[0] }\nfunction tail(ls) { return ls.slice(1) }\nfunction init(ls) { return ls.slice(0, -1) }\nfunction last(ls) { return ls[ls.length - 1] }\n\n\n\nclass VZCubeElement extends HTMLElement {\n    createdCallback() {\n        this.isAnimating    = false\n        this._isDragging     = false\n\n        this.yaw    = 0\n        this.pitch  = 0\n\n        this._handleMouseDown   = this._handleMouseDown.bind(this)\n        this._handleMouseMove   = this._handleMouseMove.bind(this)\n        this._handleMouseUp     = this._handleMouseUp.bind(this)\n        this._handleTouchStart  = this._handleTouchStart.bind(this)\n        this._handleTouchMove   = this._handleTouchMove.bind(this)\n        this._handleTouchEnd    = this._handleTouchEnd.bind(this)\n        this._refresh           = this._refresh.bind(this)\n    }\n\n    attachedCallback() {\n        this._pivot = this.querySelector('vz-cubepivot')\n        this._addEventHandlers()\n        this._refresh()\n    }\n\n    detachedCallback() {\n        typeof cancelAnimationFrame === 'function'\n            ? cancelAnimationFrame(this._refreshId)\n            : clearTimeout(this._refreshId)\n        this._removeEventHandlers()\n    }\n\n    _addEventHandlers() {\n        this.addEventListener('mousedown', this._handleMouseDown)\n        window.addEventListener('mousemove', this._handleMouseMove)\n        window.addEventListener('mouseup', this._handleMouseUp)\n        this.addEventListener('touchstart', this._handleTouchStart)\n        this.addEventListener('touchmove', this._handleTouchMove)\n        this.addEventListener('touchend', this._handleTouchEnd)\n        this.addEventListener('touchcancel', this._handleTouchEnd)\n    }\n\n    _removeEventHandlers() {\n        this.removeEventListener('mousedown', this._handleMouseDown)\n        window.removeEventListener('mousemove', this._handleMouseMove)\n        window.removeEventListener('mouseup', this._handleMouseUp)\n        this.removeEventListener('touchstart', this._handleTouchStart)\n        this.removeEventListener('touchmove', this._handleTouchMove)\n        this.removeEventListener('touchend', this._handleTouchEnd)\n        this.removeEventListener('touchcancel', this._handleTouchEnd)\n    }\n\n    _handleMouseDown(e) {\n        this._isDragging = true\n        this._lastDragEvent = e\n    }\n\n    _handleMouseMove(e) {\n        if (!this._isDragging) return\n\n        this.yaw    += (this._lastDragEvent.pageX - e.pageX) * 0.1\n        this.pitch  -= -(this._lastDragEvent.pageY - e.pageY) * 0.1\n\n        this._lastDragEvent = e\n    }\n\n    _handleMouseUp(e) {\n        this._isDragging = false\n    }\n\n    _handleTouchStart(e) {\n        this._isDragging = true\n        this._lastDragEvent = e.touches[0]\n    }\n\n    _handleTouchMove(e) {\n        if (!this._isDragging) return\n\n        this.yaw    += (this._lastDragEvent.pageX - e.touches[0].pageX) * 0.1\n        this.pitch  -= (this._lastDragEvent.pageY - e.touches[0].pageY) * 0.1\n\n        this._lastDragEvent = e.touches[0]\n    }\n\n    _handleTouchEnd(e) {\n        this._isDragging = false\n    }\n\n\n    _refresh() {\n        const perspective = getComputedStyle(this).perspective\n\n        this._pivot.style.transform = `translateZ(${perspective}) rotateX(${this.pitch}deg) rotateY(${this.yaw}deg)`\n\n        // recurse\n        this._refreshId = typeof requestAnimationFrame === 'function'\n            ? requestAnimationFrame(this._refresh)\n            : setTimeout(this._refresh, 1000/30)\n    }\n}\n\ndocument.registerElement('vz-cube', VZCubeElement)\n"]}