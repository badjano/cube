{"version":3,"sources":["../js/vz-cube.js"],"names":["map","n","start1","stop1","start2","stop2","constraint","min","max","Math","VZCubeElement","initialR","yaw","pitch","currentR","eventStack","isAnimating","animationDuration","pivot","querySelector","_mouseDownListener","bind","_mouseUpListener","_mouseMoveListener","_touchStartListener","_touchEndListener","_touchMoveListener","_refresh","addEventListener","cancelAnimationFrame","refreshPointer","clearTimeout","interaction","push","e","window","startInteraction","addInteraction","x","pageX","y","pageY","t","timeStamp","removeEventListener","endInteraction","preventDefault","touches","duration","callback","undefined","animationStartTime","Date","now","animationStartPos","animationEndTime","animationEndPos","animationEndCallback","delta","console","log","call","addAnimationInteraction","endAnimation","firstEvent","lastEvent","length","deltaX","deltaY","perspective","parseInt","getComputedStyle","style","transform","requestAnimationFrame","setTimeout","HTMLElement","document","registerElement","Object","assign","target","varArgs","TypeError","to","index","arguments","nextSource","nextKey","prototype","hasOwnProperty"],"mappings":"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","file":"vz-cube.js","sourcesContent":["/** @see https://github.com/processing/p5.js/blob/master/src/math/calculation.js */\nfunction map(n, start1, stop1, start2 = 0, stop2 = 1) {\n    return ((n - start1) / (stop1 - start1)) * (stop2 - start2) + start2\n}\nfunction constraint(n, min = 0, max = 1) {\n    return Math.min(Math.max(n, min), max)\n}\n\n/**\n * @TODO inertia\n * @TODO get/set props from attrs\n * @TODO motion sensors (how to conciliate with pointer events)\n * @TODO relativize mouse movement to viewport-size\n */\nclass VZCubeElement extends HTMLElement {\n    createdCallback() {\n        this.initialR = { yaw: 0, pitch: 0 }\n        this.currentR = { yaw: 0, pitch: 0 }\n        this.eventStack = []\n\n        // go to point\n        this.isAnimating = false\n        this.animationDuration = 5000 // ms\n\n        // elements\n        this.pivot = this.querySelector('vz-cubepivot')\n\n        // styles\n        // this.style.cursor = 'move'\n\n        // events\n        this._mouseDownListener = this._mouseDownListener.bind(this)\n        this._mouseUpListener = this._mouseUpListener.bind(this)\n        this._mouseMoveListener = this._mouseMoveListener.bind(this)\n        this._touchStartListener = this._touchStartListener.bind(this)\n        this._touchEndListener = this._touchEndListener.bind(this)\n        this._touchMoveListener = this._touchMoveListener.bind(this)\n        this._refresh = this._refresh.bind(this)\n\n        this.addEventListener('mousedown', this._mouseDownListener)\n        this.addEventListener('touchstart', this._touchStartListener, true)\n        this.addEventListener('touchmove', this._touchMoveListener, true)\n        this.addEventListener('touchend', this._touchEndListener, true)\n        this.addEventListener('touchcancel', this._touchEndListener, true)\n    }\n\n    attachedCallback() {\n        this._refresh()\n    }\n\n    detachedCallback() {\n        (typeof cancelAnimationFrame === 'function')\n            ? cancelAnimationFrame(this.refreshPointer)\n            : clearTimeout(this.refreshPointer)\n    }\n\n    startInteraction() {\n        this.initialR = { ...this.initialR, ...this.currentR }\n        this.eventStack = []\n    }\n\n    addInteraction(interaction) {\n        this.eventStack.push(interaction)\n    }\n\n    endInteraction() {}\n\n    // ==============\n    // event handlers\n    // --------------\n\n    // mouse\n\n    _mouseDownListener(e) {\n        if (this.isAnimating) return\n\n        window.addEventListener('mousemove', this._mouseMoveListener)\n        window.addEventListener('mouseup', this._mouseUpListener)\n        this.startInteraction()\n    }\n\n    _mouseMoveListener(e) {\n        if (this.isAnimating) return\n\n        this.addInteraction({ x: e.pageX, y: e.pageY, t: e.timeStamp })\n    }\n\n    _mouseUpListener(e) {\n        window.removeEventListener('mousemove', this._mouseMoveListener)\n        window.removeEventListener('mouseup', this._mouseUpListener)\n        this.endInteraction()\n    }\n\n\n    // touch\n\n    _touchStartListener(e) {\n        if (this.isAnimating) return\n\n        this.startInteraction()\n    }\n\n    _touchMoveListener(e) {\n        if (this.isAnimating) return\n\n        e.preventDefault()\n        this.addInteraction({ x: e.touches[0].pageX, y: e.touches[0].pageY, t: e.timeStamp })\n    }\n\n    _touchEndListener(e) {\n        this.endInteraction()\n    }\n\n\n    // =====================\n    // programatic animation\n    // ---------------------\n\n    animateTo(yaw, pitch, duration = this.animationDuration, callback = undefined) {\n        this.startInteraction()\n        this.isAnimating            = true\n        this.animationStartTime     = Date.now()\n        this.animationStartPos      = this.currentR\n        this.animationEndTime       = Date.now() + duration\n        this.animationEndPos        = { yaw, pitch }\n        this.animationEndCallback   = callback\n    }\n\n    addAnimationInteraction() {\n        const t = Date.now()\n        const delta = map(t, this.animationStartTime, this.animationEndTime, 0, 1)\n        const x = map(delta, 1, 0, this.animationStartPos.yaw, this.animationEndPos.yaw)\n        const y = map(delta, 1, 0, this.animationStartPos.pitch, this.animationEndPos.pitch)\n\n        console.log(this.animationStartPos)\n\n        this.addInteraction({ x, y, t, delta })\n    }\n\n    endAnimation() {\n        this.isAnimating = false\n\n        if (typeof this.animationEndCallback === 'function') {\n            this.animationEndCallback.call(this)\n        }\n    }\n\n\n\n    // =========\n    // animation\n    // ---------\n\n    _refresh () {\n        if (this.isAnimating) {\n            this.addAnimationInteraction()\n            if (Date.now() > this.animationEndTime) this.endAnimation()\n        }\n\n        if (this.pivot) {\n            const firstEvent = this.eventStack[0]\n            const lastEvent = this.eventStack[this.eventStack.length - 1]\n\n            const deltaX = firstEvent !== undefined && lastEvent !== undefined\n                ? (lastEvent.x - firstEvent.x) * -0.2\n                : 0\n            const deltaY = firstEvent !== undefined && lastEvent !== undefined\n                ? (lastEvent.y - firstEvent.y) * 0.2\n                : 0\n\n            // apply deltas to the initial R of this interaction\n            this.currentR.yaw = this.initialR.yaw + deltaX\n            this.currentR.pitch   = constraint(this.initialR.pitch + deltaY, -90, 90) // constraint rotation arount X axis (yaw)\n\n            // apply current R to the pivot element\n            const perspective = parseInt(window.getComputedStyle(this).perspective)\n\n            this.pivot.style.transform = `translateZ(${perspective}px) rotateX(${this.currentR.pitch}deg) rotateY(${this.currentR.yaw}deg)`\n        }\n\n        // recurse\n        this.refreshPointer = (typeof requestAnimationFrame === 'function')\n            ? requestAnimationFrame(this._refresh)\n            : setTimeout(this._refresh, 1000/30)\n    }\n}\ndocument.registerElement('vz-cube', VZCubeElement)\n\n\n\n// =====================================================\n//                        Polyfills\n// -----------------------------------------------------\n/**\n * @see https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Object/assign#Polyfill\n */\nif (typeof Object.assign != 'function') {\n    Object.assign = function (target, varArgs) { // .length of function is 2\n        'use strict';\n        if (target == null) { // TypeError if undefined or null\n            throw new TypeError('Cannot convert undefined or null to object');\n        }\n\n        var to = Object(target);\n\n        for (var index = 1; index < arguments.length; index++) {\n            var nextSource = arguments[index];\n\n            if (nextSource != null) { // Skip over if undefined or null\n                for (var nextKey in nextSource) {\n                    // Avoid bugs when hasOwnProperty is shadowed\n                    if (Object.prototype.hasOwnProperty.call(nextSource, nextKey)) {\n                        to[nextKey] = nextSource[nextKey];\n                    }\n                }\n            }\n        }\n        return to;\n    };\n}\n"]}