{"version":3,"sources":["../js/vz-cube.js"],"names":["map","n","start1","stop1","start2","stop2","constraint","min","max","Math","head","ls","tail","slice","init","last","length","VZCubeElement","_isAnimating","_isDragging","_isFrozen","_draggingMultiplier","yaw","pitch","_handleMouseDown","bind","_handleMouseMove","_handleMouseUp","_handleTouchStart","_handleTouchMove","_handleTouchEnd","_processAnimation","_refresh","_pivot","querySelector","_addEventHandlers","cancelAnimationFrame","_refreshId","clearTimeout","_removeEventHandlers","duration","callback","_animationStartPos","_animationEndPos","_animationStartTime","Date","now","_animationEndTime","_animationEndCallback","t","addEventListener","window","removeEventListener","e","_lastDragEvent","pageX","pageY","touches","_easing","call","perspective","getComputedStyle","style","transform","requestAnimationFrame","setTimeout","HTMLElement","document","registerElement"],"mappings":"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","file":"vz-cube.js","sourcesContent":["/** @see https://github.com/processing/p5.js/blob/master/src/math/calculation.js */\nfunction map(n, start1, stop1, start2 = 0, stop2 = 1) {\n    return ((n - start1) / (stop1 - start1)) * (stop2 - start2) + start2\n}\nfunction constraint(n, min = 0, max = 1) {\n    return Math.min(Math.max(n, min), max)\n}\n\nfunction head(ls) { return ls[0] }\nfunction tail(ls) { return ls.slice(1) }\nfunction init(ls) { return ls.slice(0, -1) }\nfunction last(ls) { return ls[ls.length - 1] }\n\nclass VZCubeElement extends HTMLElement {\n    createdCallback() {\n        this._isAnimating   = false\n        this._isDragging    = false\n        this._isFrozen      = false\n\n        this._draggingMultiplier = 0.1\n\n        this.yaw    = 0\n        this.pitch  = 0\n\n        this._handleMouseDown   = this._handleMouseDown.bind(this)\n        this._handleMouseMove   = this._handleMouseMove.bind(this)\n        this._handleMouseUp     = this._handleMouseUp.bind(this)\n        this._handleTouchStart  = this._handleTouchStart.bind(this)\n        this._handleTouchMove   = this._handleTouchMove.bind(this)\n        this._handleTouchEnd    = this._handleTouchEnd.bind(this)\n        this._processAnimation  = this._processAnimation.bind(this)\n        this._refresh           = this._refresh.bind(this)\n    }\n\n    attachedCallback() {\n        this._pivot = this.querySelector('vz-cubepivot')\n        this._addEventHandlers()\n        this._refresh()\n    }\n\n    detachedCallback() {\n        typeof cancelAnimationFrame === 'function'\n            ? cancelAnimationFrame(this._refreshId)\n            : clearTimeout(this._refreshId)\n        this._removeEventHandlers()\n    }\n\n    animateTo(yaw, pitch, duration = 1000, callback = null) {\n        this._isAnimating = true\n        this._animationStartPos     = { yaw: this.yaw, pitch: this.pitch }\n        this._animationEndPos       = { yaw, pitch }\n        this._animationStartTime    = Date.now()\n        this._animationEndTime      = Date.now() + duration\n        this._animationEndCallback  = callback\n    }\n\n    freeze() {\n        this._isFrozen = true\n    }\n\n    unfreeze() {\n        this._isFrozen = false\n    }\n\n    _easing(t) {\n        return t<.5 ? 2*t*t : -1+(4-2*t)*t\n    }\n\n    _addEventHandlers() {\n        this.addEventListener('mousedown', this._handleMouseDown)\n        window.addEventListener('mousemove', this._handleMouseMove)\n        window.addEventListener('mouseup', this._handleMouseUp)\n        this.addEventListener('touchstart', this._handleTouchStart)\n        this.addEventListener('touchmove', this._handleTouchMove)\n        this.addEventListener('touchend', this._handleTouchEnd)\n        this.addEventListener('touchcancel', this._handleTouchEnd)\n    }\n\n    _removeEventHandlers() {\n        this.removeEventListener('mousedown', this._handleMouseDown)\n        window.removeEventListener('mousemove', this._handleMouseMove)\n        window.removeEventListener('mouseup', this._handleMouseUp)\n        this.removeEventListener('touchstart', this._handleTouchStart)\n        this.removeEventListener('touchmove', this._handleTouchMove)\n        this.removeEventListener('touchend', this._handleTouchEnd)\n        this.removeEventListener('touchcancel', this._handleTouchEnd)\n    }\n\n    _handleMouseDown(e) {\n        this._isDragging = true\n        this._lastDragEvent = e\n    }\n\n    _handleMouseMove(e) {\n        if (!this._isDragging || this._isAnimating || this._isFrozen) return\n\n        this.yaw    += (this._lastDragEvent.pageX - e.pageX) * this._draggingMultiplier\n        this.pitch  -= constraint((this._lastDragEvent.pageY - e.pageY) * this._draggingMultiplier, -70, 70)\n\n        this._lastDragEvent = e\n    }\n\n    _handleMouseUp(e) {\n        this._isDragging = false\n    }\n\n    _handleTouchStart(e) {\n        this._isDragging = true\n        this._lastDragEvent = e.touches[0]\n    }\n\n    _handleTouchMove(e) {\n        if (!this._isDragging || this._isAnimating || this._isFrozen) return\n\n        this.yaw    += (this._lastDragEvent.pageX - e.touches[0].pageX) * this._draggingMultiplier\n        this.pitch  -= (this._lastDragEvent.pageY - e.touches[0].pageY) * this._draggingMultiplier\n\n        this._lastDragEvent = e.touches[0]\n    }\n\n    _handleTouchEnd(e) {\n        this._isDragging = false\n    }\n\n    _processAnimation() {\n        if (!this._isAnimating) return\n\n        const now = Date.now()\n        const t = map(now, this._animationStartTime, this._animationEndTime, 0, 1)\n\n        this.yaw    = map(this._easing(t), 0, 1, this._animationStartPos.yaw, this._animationEndPos.yaw)\n        this.pitch  = map(this._easing(t), 0, 1, this._animationStartPos.pitch, this._animationEndPos.pitch)\n\n        if (this._animationEndTime <= now) {\n            this._isAnimating   = false\n            this.yaw            = this._animationEndPos.yaw\n            this.pitch          = this._animationEndPos.pitch\n\n            if (typeof this._animationEndCallback === 'function') {\n                this._animationEndCallback.call(this)\n            }\n        }\n    }\n\n    _refresh() {\n        this._processAnimation()\n\n        const perspective = getComputedStyle(this).perspective\n\n        this._pivot.style.transform = `translateZ(${perspective}) rotateX(${this.pitch}deg) rotateY(${this.yaw}deg)`\n\n        // recurse\n        this._refreshId = typeof requestAnimationFrame === 'function'\n            ? requestAnimationFrame(this._refresh)\n            : setTimeout(this._refresh, 1000/30)\n    }\n}\n\ndocument.registerElement('vz-cube', VZCubeElement)\n"]}