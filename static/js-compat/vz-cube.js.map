{"version":3,"sources":["../js/vz-cube.js"],"names":["map","n","start1","stop1","start2","stop2","constraint","min","max","Math","head","ls","tail","slice","init","last","length","VZCubeElement","_isAnimating","_isDragging","_isFrozen","_draggingMultiplier","yaw","pitch","_handleMouseDown","bind","_handleMouseMove","_handleMouseUp","_handleTouchStart","_handleTouchMove","_handleTouchEnd","_processAnimation","_refresh","_pivot","querySelector","_addEventHandlers","cancelAnimationFrame","_refreshId","clearTimeout","_removeEventHandlers","duration","callback","_animationStartPos","_animationEndPos","parseFloat","_animationStartTime","Date","now","_animationEndTime","_animationEndCallback","setAttribute","removeAttribute","t","addEventListener","window","removeEventListener","e","_lastDragEvent","pageX","pageY","touches","_easing","requestAnimationFrame","call","perspective","getComputedStyle","style","transform","setTimeout","HTMLElement","customElements","define","VZCubeFeature","_yaw","getAttribute","_pitch","attrName","oldVal","newVal"],"mappings":"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","file":"vz-cube.js","sourcesContent":["/** @see https://github.com/processing/p5.js/blob/master/src/math/calculation.js */\nfunction map(n, start1, stop1, start2 = 0, stop2 = 1) {\n    return ((n - start1) / (stop1 - start1)) * (stop2 - start2) + start2\n}\nfunction constraint(n, min = 0, max = 1) {\n    return Math.min(Math.max(n, min), max)\n}\n\nfunction head(ls) { return ls[0] }\nfunction tail(ls) { return ls.slice(1) }\nfunction init(ls) { return ls.slice(0, -1) }\nfunction last(ls) { return ls[ls.length - 1] }\n\n\n\n\nclass VZCubeElement extends HTMLElement {\n    constructor() {\n        super()\n\n        this._isAnimating   = false\n        this._isDragging    = false\n        this._isFrozen      = false\n\n        this._draggingMultiplier = 0.1\n\n        this.yaw    = 0\n        this.pitch  = 0\n\n        this._handleMouseDown   = this._handleMouseDown.bind(this)\n        this._handleMouseMove   = this._handleMouseMove.bind(this)\n        this._handleMouseUp     = this._handleMouseUp.bind(this)\n        this._handleTouchStart  = this._handleTouchStart.bind(this)\n        this._handleTouchMove   = this._handleTouchMove.bind(this)\n        this._handleTouchEnd    = this._handleTouchEnd.bind(this)\n        this._processAnimation  = this._processAnimation.bind(this)\n        this._refresh           = this._refresh.bind(this)\n    }\n\n    connectedCallback() {\n        this._pivot = this.querySelector('vz-cubepivot')\n        this._addEventHandlers()\n        this._refresh()\n    }\n\n    disconnectedCallback() {\n        typeof cancelAnimationFrame === 'function'\n            ? cancelAnimationFrame(this._refreshId)\n            : clearTimeout(this._refreshId)\n\n        this._removeEventHandlers()\n    }\n\n    animateTo(yaw, pitch, duration = 1000, callback = null) {\n        this._isAnimating = true\n        this._animationStartPos     = { yaw: this.yaw, pitch: this.pitch }\n        this._animationEndPos       = { yaw: parseFloat(yaw) || 0, pitch: parseFloat(pitch) || 0 }\n        this._animationStartTime    = Date.now()\n        this._animationEndTime      = Date.now() + duration\n        this._animationEndCallback  = callback\n    }\n\n    freeze() {\n        this._isFrozen = true\n    }\n\n    unfreeze() {\n        this._isFrozen = false\n    }\n\n    zoomIn() {\n        this.setAttribute('zoom', true)\n    }\n    zoomOut() {\n        this.removeAttribute('zoom')\n    }\n\n    _easing(t) {\n        return t<.5 ? 2*t*t : -1+(4-2*t)*t\n    }\n\n    _addEventHandlers() {\n        this.addEventListener('mousedown', this._handleMouseDown)\n        window.addEventListener('mousemove', this._handleMouseMove)\n        window.addEventListener('mouseup', this._handleMouseUp)\n        this.addEventListener('touchstart', this._handleTouchStart)\n        this.addEventListener('touchmove', this._handleTouchMove)\n        this.addEventListener('touchend', this._handleTouchEnd)\n        this.addEventListener('touchcancel', this._handleTouchEnd)\n    }\n\n    _removeEventHandlers() {\n        this.removeEventListener('mousedown', this._handleMouseDown)\n        window.removeEventListener('mousemove', this._handleMouseMove)\n        window.removeEventListener('mouseup', this._handleMouseUp)\n        this.removeEventListener('touchstart', this._handleTouchStart)\n        this.removeEventListener('touchmove', this._handleTouchMove)\n        this.removeEventListener('touchend', this._handleTouchEnd)\n        this.removeEventListener('touchcancel', this._handleTouchEnd)\n    }\n\n    _handleMouseDown(e) {\n        this._isDragging = true\n        this._lastDragEvent = e\n    }\n\n    _handleMouseMove(e) {\n        if (!this._isDragging || this._isAnimating || this._isFrozen) return\n\n        this.yaw    += (this._lastDragEvent.pageX - e.pageX) * this._draggingMultiplier\n        this.pitch  -= constraint((this._lastDragEvent.pageY - e.pageY) * this._draggingMultiplier, -70, 70)\n\n        this._lastDragEvent = e\n    }\n\n    _handleMouseUp(e) {\n        this._isDragging = false\n    }\n\n    _handleTouchStart(e) {\n        this._isDragging = true\n        this._lastDragEvent = e.touches[0]\n    }\n\n    _handleTouchMove(e) {\n        if (!this._isDragging || this._isAnimating || this._isFrozen) return\n\n        this.yaw    += (this._lastDragEvent.pageX - e.touches[0].pageX) * this._draggingMultiplier\n        this.pitch  -= (this._lastDragEvent.pageY - e.touches[0].pageY) * this._draggingMultiplier\n\n        this._lastDragEvent = e.touches[0]\n    }\n\n    _handleTouchEnd(e) {\n        this._isDragging = false\n    }\n\n    _processAnimation() {\n        if (!this._isAnimating) return\n\n        const now = Date.now()\n        const t = map(now, this._animationStartTime, this._animationEndTime, 0, 1)\n\n        this.yaw    = map(this._easing(t), 0, 1, this._animationStartPos.yaw, this._animationEndPos.yaw)\n        this.pitch  = map(this._easing(t), 0, 1, this._animationStartPos.pitch, this._animationEndPos.pitch)\n\n        if (this._animationEndTime <= now) {\n            this._isAnimating   = false\n            this.yaw            = this._animationEndPos.yaw\n            this.pitch          = this._animationEndPos.pitch\n\n            if (typeof this._animationEndCallback === 'function') {\n                requestAnimationFrame(_ => this._animationEndCallback.call(this))\n            }\n        }\n    }\n\n    _refresh() {\n        this._processAnimation()\n\n        const perspective = getComputedStyle(this).perspective\n\n        this._pivot.style.transform = `translateZ(${perspective}) rotateX(${this.pitch}deg) rotateY(${this.yaw}deg)`\n\n        // recurse\n        this._refreshId = typeof requestAnimationFrame === 'function'\n            ? requestAnimationFrame(this._refresh)\n            : setTimeout(this._refresh, 1000/30)\n    }\n}\n\ncustomElements.define('vz-cube', VZCubeElement)\n\n\n\nclass VZCubeFeature extends HTMLElement {\n    constructor () {\n        super()\n\n        this._yaw       = this.getAttribute('yaw')\n        this._pitch     = this.getAttribute('pitch')\n        this._refresh   = this._refresh.bind(this)\n\n        this._refresh()\n    }\n\n    connectedCallback() {\n    }\n\n    attributeChangedCallback(attrName, oldVal, newVal) {\n        switch (attrName) {\n            case 'yaw':\n                this._yaw = parseFloat(newVal) || 0; break\n            case 'pitch':\n                this._pitch = parseFloat(newVal) || 0; break\n        }\n\n        this._refresh()\n    }\n\n    _refresh() {\n        this.style.transform = `rotateY(${this.yaw}deg) rotateX(${this.pitch}deg) translateZ(calc(-50vmax + 2rem))`\n    }\n\n    get yaw() {\n        return this._yaw\n    }\n    get pitch() {\n        return this._pitch\n    }\n}\n\ncustomElements.define('vz-cube-feature', VZCubeFeature);\n"]}