{"version":3,"sources":["../js/vz-cube.js"],"names":["map","n","start1","stop1","start2","stop2","constraint","min","max","Math","head","ls","tail","slice","init","last","length","realOrientation","lastGamma","rotation3d","verticalY","getOrientation","window","orientation","e","gamma","abs","x","y","alpha","beta","newY","VZCubeElement","_isAnimating","_isDragging","_isFrozen","_draggingMultiplier","yaw","pitch","_handleMouseDown","bind","_handleMouseMove","_handleMouseUp","_handleTouchStart","_handleTouchMove","_handleTouchEnd","_handleOrientation","_processAnimation","_refresh","_pivot","querySelector","_addEventHandlers","cancelAnimationFrame","_refreshId","clearTimeout","_removeEventHandlers","duration","callback","altYaw","_animationStartPos","_animationEndPos","parseFloat","_animationStartTime","Date","now","_animationEndTime","_animationEndCallback","setAttribute","removeAttribute","t","addEventListener","removeEventListener","_lastDragEvent","pageX","pageY","touches","currentOrientation","_lastOrientation","undefined","console","log","_easing","requestAnimationFrame","call","_normalize","perspective","getComputedStyle","style","transform","setTimeout","HTMLElement","customElements","define","VZCubeFeature","_yaw","getAttribute","_pitch","attrName","oldVal","newVal"],"mappings":"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","file":"vz-cube.js","sourcesContent":["/** @see https://github.com/processing/p5.js/blob/master/src/math/calculation.js */\n\nfunction map(n, start1, stop1, start2 = 0, stop2 = 1) {\n    return ((n - start1) / (stop1 - start1)) * (stop2 - start2) + start2\n}\nfunction constraint(n, min = 0, max = 1) {\n    return Math.min(Math.max(n, min), max)\n}\n\nfunction head(ls) { return ls[0] }\nfunction tail(ls) { return ls.slice(1) }\nfunction init(ls) { return ls.slice(0, -1) }\nfunction last(ls) { return ls[ls.length - 1] }\n\n\n\nlet realOrientation, lastGamma, rotation3d, verticalY\nconst getOrientation = e => {\n    let rotation3d = {}\n\n    if (realOrientation == null) { realOrientation = window.orientation; }\n    if (lastGamma == null) { lastGamma = e.gamma; }\n\n    if (Math.abs(e.gamma) < 10) {\n        if (lastGamma * e.gamma < 0) {\n            realOrientation = -realOrientation;\n            lastGamma = e.gamma;\n        }\n    } else {\n        if (lastGamma * e.gamma < 0) {\n            lastGamma = e.gamma;\n        }\n    }\n\n\n    if (realOrientation == 90) {\n        if (e.gamma < 0) {\n            rotation3d.x = -90 - e.gamma;\n            rotation3d.y = -e.alpha;\n        } else {\n            rotation3d.x = 90 - e.gamma;\n            rotation3d.y = 180 - e.alpha;\n        }\n    } else if (realOrientation == -90) {\n        if (e.gamma < 0) {\n            rotation3d.x = 90 + e.gamma;\n            rotation3d.y = -e.alpha;\n        } else {\n            rotation3d.x = -90 + e.gamma;\n            rotation3d.y = 180 - e.alpha;\n        }\n    } else if (realOrientation == 0) {\n        rotation3d.x = e.beta - 90;\n        if (verticalY != null) {\n            var newY = 180 - e.alpha\n            if (Math.abs(verticalY - newY) < 10) {\n                rotation3d.y = 180 - e.alpha;\n            }\n        }\n        verticalY = 180 - e.alpha;\n    } else {\n        rotation3d.x = e.beta - 90;\n        rotation3d.y = 180 - e.alpha;\n    }\n    if (realOrientation != window.orientation) {\n        rotation3d.y = 180 + rotation3d.y;\n    }\n\n    return rotation3d\n}\n\n\nclass VZCubeElement extends HTMLElement {\n    constructor() {\n        super()\n\n        this._isAnimating   = false\n        this._isDragging    = false\n        this._isFrozen      = false\n\n        this._draggingMultiplier = 0.1\n\n        this.yaw    = 0\n        this.pitch  = 0\n\n        this._handleMouseDown   = this._handleMouseDown.bind(this)\n        this._handleMouseMove   = this._handleMouseMove.bind(this)\n        this._handleMouseUp     = this._handleMouseUp.bind(this)\n        this._handleTouchStart  = this._handleTouchStart.bind(this)\n        this._handleTouchMove   = this._handleTouchMove.bind(this)\n        this._handleTouchEnd    = this._handleTouchEnd.bind(this)\n        this._handleOrientation = this._handleOrientation.bind(this)\n        this._processAnimation  = this._processAnimation.bind(this)\n        this._refresh           = this._refresh.bind(this)\n    }\n\n    connectedCallback() {\n        this._pivot = this.querySelector('vz-cubepivot')\n        this._addEventHandlers()\n        this._refresh()\n    }\n\n    disconnectedCallback() {\n        typeof cancelAnimationFrame === 'function'\n            ? cancelAnimationFrame(this._refreshId)\n            : clearTimeout(this._refreshId)\n\n        this._removeEventHandlers()\n    }\n\n    animateTo(yaw, pitch, duration = 1000, callback = null) {\n        // set yaw to the neares yaw\n        const altYaw = yaw > 0\n            ? yaw - 360\n            : yaw + 360\n        if (Math.abs(altYaw - this.yaw) < Math.abs(yaw - this.yaw)) {\n            yaw = altYaw\n        }\n\n        this._isAnimating = true\n        this._animationStartPos     = { yaw: this.yaw, pitch: this.pitch }\n        this._animationEndPos       = { yaw: parseFloat(yaw) || 0, pitch: parseFloat(pitch) || 0 }\n        this._animationStartTime    = Date.now()\n        this._animationEndTime      = Date.now() + duration\n        this._animationEndCallback  = callback\n    }\n\n    freeze() {\n        this._isFrozen = true\n    }\n\n    unfreeze() {\n        this._isFrozen = false\n    }\n\n    zoomIn() {\n        this.setAttribute('zoom', true)\n    }\n    zoomOut() {\n        this.removeAttribute('zoom')\n    }\n\n    _easing(t) {\n        return t<.5 ? 2*t*t : -1+(4-2*t)*t\n    }\n\n    _addEventHandlers() {\n        this.addEventListener('mousedown', this._handleMouseDown)\n        window.addEventListener('mousemove', this._handleMouseMove)\n        window.addEventListener('mouseup', this._handleMouseUp)\n        this.addEventListener('touchstart', this._handleTouchStart)\n        this.addEventListener('touchmove', this._handleTouchMove)\n        this.addEventListener('touchend', this._handleTouchEnd)\n        this.addEventListener('touchcancel', this._handleTouchEnd)\n        window.addEventListener('deviceorientation', this._handleOrientation)\n    }\n\n    _removeEventHandlers() {\n        this.removeEventListener('mousedown', this._handleMouseDown)\n        window.removeEventListener('mousemove', this._handleMouseMove)\n        window.removeEventListener('mouseup', this._handleMouseUp)\n        this.removeEventListener('touchstart', this._handleTouchStart)\n        this.removeEventListener('touchmove', this._handleTouchMove)\n        this.removeEventListener('touchend', this._handleTouchEnd)\n        this.removeEventListener('touchcancel', this._handleTouchEnd)\n        window.removeEventListener('deviceorientation', this._handleOrientation)\n    }\n\n    _handleMouseDown(e) {\n        this._isDragging = true\n        this._lastDragEvent = e\n    }\n\n    _handleMouseMove(e) {\n        if (!this._isDragging || this._isAnimating || this._isFrozen) return\n\n        this.yaw    += (this._lastDragEvent.pageX - e.pageX) * this._draggingMultiplier\n        this.pitch  -= constraint((this._lastDragEvent.pageY - e.pageY) * this._draggingMultiplier, -70, 70)\n\n        this._lastDragEvent = e\n    }\n\n    _handleMouseUp(e) {\n        this._isDragging = false\n    }\n\n    _handleTouchStart(e) {\n        this._isDragging = true\n        this._lastDragEvent = e.touches[0]\n    }\n\n    _handleTouchMove(e) {\n        if (!this._isDragging || this._isAnimating || this._isFrozen) return\n\n        this.yaw    += (this._lastDragEvent.pageX - e.touches[0].pageX) * this._draggingMultiplier\n        this.pitch  -= (this._lastDragEvent.pageY - e.touches[0].pageY) * this._draggingMultiplier\n\n        this._lastDragEvent = e.touches[0]\n    }\n\n    _handleTouchEnd(e) {\n        this._isDragging = false\n    }\n\n    _handleOrientation(e) {\n        const currentOrientation = getOrientation(e)\n\n        if (this._lastOrientation !== undefined) {\n            console.log()\n\n            // console.log(this._lastOrientation.y, currentOrientation.y)\n            this.yaw     -= (this._lastOrientation.y - currentOrientation.y) || 0\n            this.pitch   -= (this._lastOrientation.x - currentOrientation.x) || 0\n        }\n        \n\n        this._lastOrientation = currentOrientation\n    }\n\n\n    _processAnimation() {\n        if (!this._isAnimating) return\n\n        const now = Date.now()\n        const t = map(now, this._animationStartTime, this._animationEndTime, 0, 1)\n\n        this.yaw    = map(this._easing(t), 0, 1, this._animationStartPos.yaw, this._animationEndPos.yaw)\n        this.pitch  = map(this._easing(t), 0, 1, this._animationStartPos.pitch, this._animationEndPos.pitch)\n\n        if (this._animationEndTime <= now) {\n            this._isAnimating   = false\n            this.yaw            = this._animationEndPos.yaw\n            this.pitch          = this._animationEndPos.pitch\n\n            // @TODO normalize\n\n            if (typeof this._animationEndCallback === 'function') {\n                requestAnimationFrame(_ => this._animationEndCallback.call(this))\n            }\n        }\n    }\n\n    _normalize() {\n        this.pitch = constraint(this.pitch, -70, 70)\n        if (this.yaw > 180) this.yaw -= 360\n        if (this.yaw < -180) this.yaw += 360\n    }\n\n    _refresh() {\n        this._processAnimation()\n        this._normalize()\n\n        const perspective = getComputedStyle(this).perspective\n\n        this._pivot.style.transform = `translateZ(${perspective}) rotateX(${this.pitch}deg) rotateY(${this.yaw}deg)`\n\n        // recurse\n        this._refreshId = typeof requestAnimationFrame === 'function'\n            ? requestAnimationFrame(this._refresh)\n            : setTimeout(this._refresh, 1000/30)\n    }\n}\n\ncustomElements.define('vz-cube', VZCubeElement)\n\n\n\nclass VZCubeFeature extends HTMLElement {\n    constructor () {\n        super()\n\n        this._yaw       = this.getAttribute('yaw')\n        this._pitch     = this.getAttribute('pitch')\n        this._refresh   = this._refresh.bind(this)\n\n        this._refresh()\n    }\n\n    connectedCallback() {\n    }\n\n    attributeChangedCallback(attrName, oldVal, newVal) {\n        switch (attrName) {\n            case 'yaw':\n                this._yaw = parseFloat(newVal) || 0; break\n            case 'pitch':\n                this._pitch = parseFloat(newVal) || 0; break\n        }\n\n        this._refresh()\n    }\n\n    _refresh() {\n        this.style.transform = `rotateY(${this.yaw}deg) rotateX(${this.pitch}deg) translateZ(calc(-50vmax + 2rem))`\n    }\n\n    get yaw() {\n        return this._yaw\n    }\n    get pitch() {\n        return this._pitch\n    }\n}\n\ncustomElements.define('vz-cube-feature', VZCubeFeature);\n"]}